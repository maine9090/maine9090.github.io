<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>Unitral</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="styles/oneui.css">
        <script src="https://kit.fontawesome.com/083e26693c.js" crossorigin="anonymous"></script>
        <style>
            body {
                margin: 0;
                overflow: hidden; /* prevent window scroll */
            }

            .pageheader {
                position: fixed;
                top: 0; left: 0; width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #f0f3f7;
                height: 50vh;
                font-size: 40px;
                transition: justify-content 0.2s, padding-left 0.2s;
                z-index: 10;
            }

            .maincontent {
                position: absolute;
                top: 0; left: 0; right: 0; bottom: 0;
                margin-top: 50vh;
                padding: 1rem;
                overflow-y: auto;
                background: white;
                border-radius: 35px 35px 0 0;
            }
        </style>
    </head>

    <body>
        <header id="pageHeader" class="pageheader">Page Title</header>
        <div id="mainContent" class="maincontent">
            <h3 class="subheader">Insulin Unit Calculator</h3>
            <div style="padding:0px 5%;"><hr style="background-color:#c5c5c5"></div>
            <br>
            <div style="padding:0px 5%">
                <div class="textboxcontainer">
                    <input type="text" class="textbox" placeholder="Carbohydrates">
                    <input type="text" class="textbox" placeholder="Ratio">
                </div>
                <div class="textboxcontainer">
                    <input type="text" class="textbox" placeholder="BG (mmol/l)">
                    <input type="text" class="textbox" placeholder="Sensitivity Factor">
                </div>

                <br>

                <div class="button-split-half">
                    <button class="ripple-button">Calculate</button>
                    <button class="ripple-button" style="background-color:rgb(235, 235, 235);color:rgb(155, 155, 155)">Help</button>
                </div>
            </div>
            
            <div style="height:2000px">…long content…</div>
        </div>

        <script>
            document.querySelectorAll('.ripple-button').forEach(button => {
                button.addEventListener('click', function (e) {
                    const circle = document.createElement('span');
                    circle.classList.add('ripple');

                    const rect = button.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    circle.style.width = circle.style.height = `${size}px`;

                    circle.style.left = `${e.clientX - rect.left - size / 2}px`;
                    circle.style.top = `${e.clientY - rect.top - size / 2}px`;

                    button.appendChild(circle);

                    setTimeout(() => circle.remove(), 600);
                });
            });

            (function() {
            const header     = document.getElementById('pageHeader');
            const content    = document.getElementById('mainContent');
            const maxScroll  = 200;
            let offsetY      = 0;

            function updateHeader(offset) {
                const pct = offset / maxScroll;
                const alpha = 1 - pct
                const h0 = 50, h1 = 10; // vh
                const f0 = 40, f1 = 20; // px
                const vh = h0 - (h0 - h1) * pct;
                const fs = f0 - (f0 - f1) * pct;

                header.style.height     = vh + 'vh';
                header.style.fontSize   = fs + 'px';
                header.style.color = `rgba(0, 0, 0, ${alpha})`; // warm orange with 60% opacity
                content.style.marginTop = vh + 'vh';

                if (pct === 1) {
                header.style.justifyContent = 'flex-start';
                header.style.paddingLeft    = '25px';
                header.style.color = 'rgb(0,0,0)'
                } else {
                header.style.justifyContent = 'center';
                header.style.paddingLeft    = '0';
                }
            }

            // Wheel scroll
            function onWheel(e) {
                const dy = e.deltaY;

                if (dy > 0 && offsetY < maxScroll) {
                e.preventDefault();
                offsetY = Math.min(offsetY + dy, maxScroll);
                updateHeader(offsetY);
                } else if (dy < 0 && content.scrollTop === 0 && offsetY > 0) {
                e.preventDefault();
                offsetY = Math.max(offsetY + dy, 0);
                updateHeader(offsetY);
                } else {
                if (e.currentTarget === header) {
                    content.scrollBy({ top: dy, behavior: 'auto' });
                }
                }
            }

            // Touch scroll
            let startY = 0;
            function onTouchStart(e) {
                startY = e.touches[0].clientY;
            }

            function onTouchMove(e) {
                const y = e.touches[0].clientY;
                const dy = startY - y;
                startY = y;

                if (dy > 0 && offsetY < maxScroll) {
                e.preventDefault();
                offsetY = Math.min(offsetY + dy, maxScroll);
                updateHeader(offsetY);
                } else if (dy < 0 && content.scrollTop === 0 && offsetY > 0) {
                e.preventDefault();
                offsetY = Math.max(offsetY + dy, 0);
                updateHeader(offsetY);
                } else {
                if (e.currentTarget === header) {
                    content.scrollBy({ top: dy, behavior: 'auto' });
                }
                }
            }

            // Attach listeners to both areas
            [header, content].forEach(el => {
                el.addEventListener('wheel', onWheel, { passive: false });
                el.addEventListener('touchstart', onTouchStart, { passive: true });
                el.addEventListener('touchmove', onTouchMove, { passive: false });
            });
            })();
        </script>

    </body>
</html>